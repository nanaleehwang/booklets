---
layout: fullscreen
---

{% assign booklet_chapters = site.booklets | where: "booklet", page.booklet | sort: "chapter_number" %}
{% assign booklet = site.booklets | where: "slug", page.booklet | first %}

<div class="fullscreen-container">
  <header class="fullscreen-header">
    <div class="booklet-info">
      <a href="{{ '/booklets/' | append: page.booklet | relative_url }}">
        ← {{ booklet.title }}
      </a>
    </div>
  </header>

  <div class="chapter-viewer">
    <nav class="sidebar-toc">
      <div class="toc-chapters">
        <ul>
          {% for chapter in booklet_chapters %}
          <li class="{% if chapter.url == page.url %}active{% endif %}">
            <a href="{{ chapter.url | relative_url }}">
              <span class="chapter-number">{{ chapter.chapter_number }}.</span>
              <span class="chapter-title">{{ chapter.title }}</span>
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
    </nav>

    <main class="fullscreen-content">
      <article class="chapter">
        <header class="chapter-header">
          <span class="chapter-number">Chapter {{ page.chapter_number }}</span>
          <h1>{{ page.title }}</h1>
          {% if page.subtitle %}<p class="subtitle">{{ page.subtitle }}</p>{% endif %}
          {% if page.author %}<p class="author">{{ page.author }}</p>{% endif %}
        </header>

        <div class="chapter-body">
          {{ content }}
        </div>

        <footer class="chapter-navigation">
          {% assign prev_chapter = nil %}
          {% assign next_chapter = nil %}

          {% for chapter in booklet_chapters %}
          {% if chapter.chapter_number == page.chapter_number %}
          {% assign current_index = forloop.index0 %}
          {% break %}
          {% endif %}
          {% endfor %}

          {% if current_index > 0 %}
          {% assign prev_index = current_index | minus: 1 %}
          {% assign prev_chapter = booklet_chapters[prev_index] %}
          {% endif %}

          {% assign next_index = current_index | plus: 1 %}
          {% if next_index < booklet_chapters.size %} {% assign next_chapter=booklet_chapters[next_index] %} {% endif %}
            <div class="nav-buttons">
            {% if prev_chapter %}
            <a href="{{ prev_chapter.url | relative_url }}" class="nav-button prev">
              <span class="nav-label">← Previous</span>
              <span class="nav-title">{{ prev_chapter.title }}</span>
            </a>
            {% else %}
            <span class="nav-button disabled">
              <span class="nav-label">← Previous</span>
            </span>
            {% endif %}

            {% if next_chapter %}
            <a href="{{ next_chapter.url | relative_url }}" class="nav-button next">
              <span class="nav-label">Next →</span>
              <span class="nav-title">{{ next_chapter.title }}</span>
            </a>
            {% else %}
            <span class="nav-button disabled">
              <span class="nav-label">Next →</span>
            </span>
            {% endif %}
  </div>
   </footer>
   </article>
   </main>
 </div>

 <script>
 let lastScrollTop = 0;
 const header = document.querySelector('.fullscreen-header');
 const container = document.querySelector('.fullscreen-container');

 function updateHeaderVisibility() {
   const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

   if (window.innerWidth <= 768) {
     if (scrollTop > lastScrollTop && scrollTop > 100) {
       // Scrolling down and past 100px
       header.classList.add('header-hidden');
       container.classList.add('header-hidden');
     } else if (scrollTop < lastScrollTop) {
       // Scrolling up
       header.classList.remove('header-hidden');
       container.classList.remove('header-hidden');
     }
   } else {
     // Desktop mode, ensure header is visible
     header.classList.remove('header-hidden');
     container.classList.remove('header-hidden');
   }

   lastScrollTop = scrollTop;
 }

 window.addEventListener('scroll', updateHeaderVisibility);
 window.addEventListener('resize', function() {
   if (window.innerWidth > 768) {
     header.classList.remove('header-hidden');
     container.classList.remove('header-hidden');
   }

   const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

   if (window.innerWidth <= 768) {
     if (scrollTop > lastScrollTop && scrollTop > 100) {
       // Scrolling down and past 100px
       header.classList.add('header-hidden');
       container.classList.add('header-hidden');
     } else if (scrollTop < lastScrollTop) {
       // Scrolling up
       header.classList.remove('header-hidden');
       container.classList.remove('header-hidden');
     }
   }

   lastScrollTop = scrollTop;
 });
 </script>
</div>
